# Story 6.4: Visual Enhancements (ÏãúÍ∞ÅÏ†Å Í∞úÏÑ†)

## Status

Approved

## Story

**As a** ÏÇ¨Ïö©Ïûê,
**I want** ÏÑ†ÌÉùÎêú Ïä§ÌÇ¨, Ï¶êÍ≤®Ï∞æÍ∏∞, ÏµúÍ∑º ÏÇ¨Ïö© Îì±Ïùò ÏÉÅÌÉúÍ∞Ä ÏãúÍ∞ÅÏ†ÅÏúºÎ°ú Î™ÖÌôïÌïòÍ≤å ÌëúÏãúÎêòÍ∏∏ ÏõêÌïúÎã§,
**so that** UIÎ•º Ìïú ÎààÏóê Ïù¥Ìï¥ÌïòÍ≥† ÏõêÌïòÎäî Ï†ïÎ≥¥Î•º Îπ†Î•¥Í≤å Ï∞æÏùÑ Ïàò ÏûàÎã§.

## Acceptance Criteria

1. ÏÑ†ÌÉùÎêú Ïä§ÌÇ¨Ïóê Î™ÖÌôïÌïú ÏãúÍ∞ÅÏ†Å ÌëúÏãú (ÌôîÏÇ¥Ìëú ÎòêÎäî ÌäπÎ≥ÑÌïú ÌïòÏù¥ÎùºÏù¥Ìä∏)
2. Ï¶êÍ≤®Ï∞æÍ∏∞ Ïä§ÌÇ¨Ïóê Î≥Ñ(‚≠ê) ÏïÑÏù¥ÏΩò ÌëúÏãúÎê®
3. ÏµúÍ∑º ÏÇ¨Ïö© Ïä§ÌÇ¨Ïóê ÏãúÍ≥Ñ(üïê) ÏïÑÏù¥ÏΩò ÌëúÏãúÎê®
4. ÌÉúÍ∑∏Ïóê ÏÉâÏÉÅÏù¥ Ï†ÅÏö©Îê® (Ïπ¥ÌÖåÍ≥†Î¶¨Î≥ÑÎ°ú Îã§Î•∏ ÏÉâÏÉÅ)
5. ÏÑ†ÌÉù ÌïòÏù¥ÎùºÏù¥Ìä∏Í∞Ä ÌòÑÏû¨ ÌÖåÎßàÏôÄ Ï°∞ÌôîÎ°≠Í≤å ÌëúÏãúÎê®
6. ÏïÑÏù¥ÏΩòÏù¥ ÏûàÏñ¥ÎèÑ ÌÖçÏä§Ìä∏Í∞Ä Ïûò ÏùΩÌûò (ÎÑàÎπÑ Ï∂©Î∂Ñ)
7. Ïã§Ìñâ Ï§ë Ïä§ÌÇ¨Ïóê Î°úÎî© ÌëúÏãú Ï∂îÍ∞Ä (ÏÑ†ÌÉùÏÇ¨Ìï≠)
8. Î™®Îì† Í∏∞Ï°¥ ÌÖåÏä§Ìä∏Í∞Ä ÌÜµÍ≥ºÌï®

## Tasks / Subtasks

- [ ] Add visual indicator for selected skill (AC: 1)
  - [ ] Modify `src/ui/components/skill_list.rs` to add arrow indicator
  - [ ] Use "‚Üí " prefix for selected skill or distinctive border style
  - [ ] Ensure indicator is visible in both wide and narrow terminals
  - [ ] Test with different terminal widths

- [ ] Add favorite icon to skill list items (AC: 2, 6)
  - [ ] Modify `format_skill_item()` in `src/ui/components/skill_list.rs`
  - [ ] Add "‚≠ê " prefix for favorited skills
  - [ ] Check if skill is in favorites set (need AppState reference)
  - [ ] Update `render_skill_list()` signature to accept favorites set
  - [ ] Ensure text doesn't get truncated due to icon

- [ ] Add recent usage icon to skill list items (AC: 3, 6)
  - [ ] Modify `format_skill_item()` to check recent skills
  - [ ] Add "üïê " prefix for recently used skills
  - [ ] Pass recent skills list to `render_skill_list()`
  - [ ] Icons should not overlap (e.g., "‚≠êüïê skill-name" for both)

- [ ] Apply tag colors based on category (AC: 4, 5)
  - [ ] Create tag color mapping function in `src/ui/theme.rs`
  - [ ] Map common tags to colors:
    - "dev", "development" ‚Üí Blue
    - "ops", "devops", "deploy" ‚Üí Green
    - "test", "testing" ‚Üí Yellow
    - "doc", "docs", "documentation" ‚Üí Cyan
    - "util", "utility" ‚Üí Magenta
    - Default ‚Üí theme.text_dim
  - [ ] Apply colors in `format_skill_item()` when rendering tags
  - [ ] Ensure colors work with both light and dark terminals

- [ ] Enhance selection highlight (AC: 1, 5)
  - [ ] Use theme.selected_style() for selected skill background
  - [ ] Consider adding border emphasis or different character
  - [ ] Test visibility against different terminal backgrounds

- [ ] Add loading indicator for executing skills (AC: 7, optional)
  - [ ] Add spinner or "‚ü≥" symbol next to executing skill
  - [ ] Check `state.is_executing_inline()` and `state.inline_execution_status()`
  - [ ] Show indicator only when skill is actually running
  - [ ] Remove indicator when execution completes

- [ ] Update tests for new visual elements (AC: 8)
  - [ ] Update existing `format_skill_item` tests to account for icons
  - [ ] Add test for favorite icon display
  - [ ] Add test for recent icon display
  - [ ] Add test for combined icons (favorite + recent)
  - [ ] Add test for tag color mapping
  - [ ] Ensure all tests pass with new visual elements

- [ ] Manual testing and validation
  - [ ] Test with favorite skills - icon appears
  - [ ] Test with recent skills - icon appears
  - [ ] Test with both - both icons appear
  - [ ] Test tag colors - different tags have different colors
  - [ ] Test selection indicator - clearly visible
  - [ ] Test in narrow terminal - icons don't break layout
  - [ ] Test in wide terminal - layout looks good

## Dev Notes

### Current UI Structure

**Skill List Rendering** (from Story 2.3):

The skill list is rendered in `src/ui/components/skill_list.rs`:

```rust
pub fn render_skill_list(
    area: Rect,
    frame: &mut Frame,
    skills: &[&Skill],
    selected_index: usize,
    scroll_offset: usize,
    theme: &ThemeConfig,
)
```

Individual skill items are formatted with `format_skill_item()`:

```rust
fn format_skill_item(skill: &Skill, max_width: usize, theme: &ThemeConfig) -> Line
```

[Source: src/ui/components/skill_list.rs]

### Icon Implementation Strategy

**Unicode Icons**:
- ‚≠ê (U+2B50) - Favorite/starred
- üïê (U+1F550) - Recent/clock
- ‚Üí (U+2192) - Selection arrow
- ‚ü≥ (U+27F3) - Loading/refresh (optional)

**Layout Example**:

```
Current:
  claude-tips               [dev, cli] ~30s

With Icons (favorite):
‚Üí ‚≠ê claude-tips            [dev, cli] ~30s

With Icons (recent):
  üïê docker-build           [ops] ~2m

With Icons (both):
‚Üí ‚≠êüïê git-helper           [dev, util] ~10s
```

**Width Calculation**:
- Arrow: 2 chars ("‚Üí ")
- Star: 2 chars ("‚≠ê ")
- Clock: 2 chars ("üïê ")
- Max prefix: 6 chars ("‚Üí ‚≠êüïê ")

Need to adjust `max_width` calculation in `format_skill_item()` to account for icon width.

### Tag Color Mapping

**Proposed Color Scheme**:

```rust
fn tag_color(tag: &str, theme: &ThemeConfig) -> Color {
    match tag.to_lowercase().as_str() {
        "dev" | "development" | "code" => Color::Blue,
        "ops" | "devops" | "deploy" | "infra" => Color::Green,
        "test" | "testing" | "qa" => Color::Yellow,
        "doc" | "docs" | "documentation" => Color::Cyan,
        "util" | "utility" | "tool" => Color::Magenta,
        "security" | "sec" => Color::Red,
        _ => theme.text_dim,
    }
}
```

Apply in tag rendering:

```rust
let tag_spans: Vec<Span> = skill.manifest.tags.iter()
    .map(|tag| {
        let color = tag_color(tag, theme);
        Span::styled(tag, Style::default().fg(color))
    })
    .collect();
```

### AppState Access for Icons

Current `render_skill_list()` receives `&[&Skill]` but needs access to:
- `favorites: HashSet<String>` - To show ‚≠ê
- `recent: Vec<String>` - To show üïê

**Option 1**: Pass additional parameters
```rust
pub fn render_skill_list(
    area: Rect,
    frame: &mut Frame,
    skills: &[&Skill],
    selected_index: usize,
    scroll_offset: usize,
    favorites: &HashSet<String>,  // NEW
    recent: &[String],             // NEW
    theme: &ThemeConfig,
)
```

**Option 2**: Pass entire AppState
```rust
pub fn render_skill_list(
    area: Rect,
    frame: &mut Frame,
    state: &AppState,  // Changed
    theme: &ThemeConfig,
)
```

**Recommendation**: Use Option 1 to keep component focused and testable.

Update `src/ui/renderer.rs` to pass these values:

```rust
render_skill_list(
    list_area,
    frame,
    &skills,
    state.selected_index(),
    state.scroll_offset(),
    state.favorites(),      // NEW
    state.recent(),         // NEW
    theme,
);
```

Need to add public getters to `AppState`:
```rust
impl AppState {
    pub fn favorites(&self) -> &HashSet<String> { &self.favorites }
    pub fn recent(&self) -> &[String] { &self.recent }
}
```

### Selection Indicator Design

**Current**: Selected item uses `theme.selected_style()` background

**Enhanced Options**:

1. **Arrow prefix** (Simple, clear):
   ```
   ‚Üí ‚≠ê claude-tips
     docker-build
     git-helper
   ```

2. **Different border** (Requires more work):
   ```
   ‚îÉ claude-tips ‚îÉ
   ‚îÇ docker-build‚îÇ
   ‚îÇ git-helper  ‚îÇ
   ```

3. **Combined** (Arrow + highlight):
   ```
   ‚Üí [claude-tips]  ‚Üê with background color
     docker-build
     git-helper
   ```

**Recommendation**: Start with arrow (Option 1), simplest and most effective.

### Loading Indicator

**Current State** (from Story 3.2):
- `AppState::is_executing_inline()` returns bool
- `AppState::inline_execution_status()` returns Option<&str>

**Proposed Enhancement**:

When rendering skill list, check if any skill is currently executing:

```rust
let is_executing = state.is_executing_inline();
let executing_skill_name = state.inline_execution_status()
    .and_then(|status| {
        // Parse "Executing skill-name..." to extract "skill-name"
        status.strip_prefix("Executing ")
            .and_then(|s| s.strip_suffix("..."))
    });

// In format_skill_item:
if is_executing && Some(skill.manifest.name.as_str()) == executing_skill_name {
    // Add ‚ü≥ spinner icon
}
```

**Alternative**: Show spinner in footer or header instead of per-skill.

### Testing Strategy

**Unit Tests**:
1. Test icon prefix generation (favorite, recent, both, none)
2. Test tag color mapping (known tags, unknown tags)
3. Test selection arrow rendering
4. Test width calculations with icons

**Integration Tests**:
1. Test full skill list rendering with icons
2. Test that icons don't break truncation logic
3. Test that colors render correctly

**Manual Tests**:
1. Mark a skill as favorite, verify ‚≠ê appears
2. Execute a skill, verify üïê appears in recent list
3. Select different skills, verify ‚Üí moves correctly
4. Verify tags have different colors
5. Test in narrow terminal (40 cols) - should still work
6. Test in wide terminal (160 cols) - should look good

### Coding Standards Compliance

**Critical Rules**:
1. ‚úÖ No `unwrap()` or `expect()` - use `?` operator or `unwrap_or_default()`
2. ‚úÖ All public functions have doc comments
3. ‚úÖ Use `&str` for string parameters where possible
4. ‚úÖ Explicit error handling with Result types

**Rust Idioms**:
- Use iterators and `map()` for tag color application
- Use `Option` for conditional icon display
- Pattern matching for tag color lookup

**Test Coverage**:
- Target: ‚â•80% coverage for new code
- AAA pattern for all tests
- Test naming: `test_<function>_<scenario>_<expected_outcome>`

[Source: docs/architecture/coding-standards.md]

## Testing

### Unit Tests

**Tag Color Mapping** (`src/ui/theme.rs` or `src/ui/components/skill_list.rs`):

1. `test_tag_color_dev_returns_blue`
   - Tag "dev" ‚Üí Color::Blue

2. `test_tag_color_ops_returns_green`
   - Tag "ops" ‚Üí Color::Green

3. `test_tag_color_unknown_returns_default`
   - Tag "random" ‚Üí theme.text_dim

**Icon Prefix Generation**:

4. `test_skill_icon_favorite_shows_star`
   - Skill in favorites ‚Üí "‚≠ê " prefix

5. `test_skill_icon_recent_shows_clock`
   - Skill in recent ‚Üí "üïê " prefix

6. `test_skill_icon_both_shows_both`
   - Skill in both ‚Üí "‚≠êüïê " prefix

7. `test_skill_icon_neither_shows_none`
   - Skill in neither ‚Üí no icon prefix

**Selection Indicator**:

8. `test_selection_arrow_shows_for_selected`
   - Selected skill ‚Üí "‚Üí " prefix

9. `test_selection_arrow_not_shown_for_unselected`
   - Unselected skill ‚Üí no arrow

**Width Calculation**:

10. `test_format_skill_item_accounts_for_icon_width`
    - Skill with icons should truncate correctly
    - Available width reduced by icon character count

### Integration Tests

**Skill List Rendering**:

1. Test rendering with mixed favorite/recent skills
2. Test that selection arrow moves correctly
3. Test that tag colors apply to all tags
4. Test rendering in narrow terminal (min width 40)
5. Test rendering in wide terminal (width 160)

### Manual Testing Checklist

- [ ] Favorite a skill, verify ‚≠ê appears next to it
- [ ] Execute a skill, verify üïê appears in Recent view
- [ ] Select a skill, verify ‚Üí arrow appears
- [ ] Navigate with j/k, verify arrow follows selection
- [ ] Check tag colors - "dev" is blue, "ops" is green, etc.
- [ ] Test in narrow terminal (resize to ~40 cols) - icons visible
- [ ] Test with skill that is both favorite and recent - both icons show
- [ ] Verify text is still readable with icons
- [ ] Verify no layout breaking in any screen size

## Change Log

| Date       | Version | Description          | Author             |
| ---------- | ------- | -------------------- | ------------------ |
| 2025-11-20 | 1.0     | Initial story creation | Dev Agent (James) |

## Dev Agent Record

### Agent Model Used

_To be filled during implementation_

### Debug Log References

_To be filled during implementation_

### Completion Notes

_To be filled during implementation_

### File List

_To be filled during implementation_

## QA Results

_To be filled by QA Agent after story completion_
