# Story 7.1: Internationalization (i18n) - Korean/English Support

## Status

Approved

## Story

**As a** 한국어 사용자,
**I want** UI의 모든 텍스트가 한국어로 표시되기를 원한다,
**so that** 모국어로 편하게 사용할 수 있다.

**As an** English user,
**I want** to keep using the app in English,
**so that** I can understand all UI text in my preferred language.

## Acceptance Criteria

1. Config 파일에 `language` 필드 추가됨 (기본값: "en")
2. 지원 언어: "en" (English), "ko" (한국어)
3. 모든 UI 텍스트가 번역 가능함:
   - Header (앱 제목)
   - Footer (키 힌트, 모드 표시)
   - Search bar (placeholder)
   - Skill list (empty state 메시지)
   - Detail pane (섹션 제목들)
   - Output panel (헤더, 상태 메시지)
4. 언어 변경 후 앱 재시작하면 새 언어로 표시됨
5. 잘못된 언어 코드는 "en"으로 fallback됨
6. 번역 누락 시 영어 텍스트로 fallback됨
7. 모든 기존 테스트가 통과함
8. 새로운 언어 추가가 쉬움 (확장성)

## Tasks / Subtasks

- [ ] Design i18n system architecture (AC: 8)
  - [ ] Decide on translation file format (TOML, JSON, or code-based)
  - [ ] Design translation key naming convention
  - [ ] Plan fallback mechanism (ko → en → hardcoded)
  - [ ] Document how to add new languages

- [ ] Add language field to Config (AC: 1, 2)
  - [ ] Add `language: String` field to `Config` struct in `src/config.rs`
  - [ ] Add `default_language()` helper returning "en"
  - [ ] Add validation in `Config::validate()` to check supported languages
  - [ ] Update `Config::default()` to use default language
  - [ ] Add documentation for language field

- [ ] Create translation infrastructure (AC: 3, 6, 8)
  - [ ] Create `src/i18n.rs` module
  - [ ] Define `Language` enum with `En`, `Ko` variants
  - [ ] Implement `Language::from_code(code: &str) -> Language` with fallback
  - [ ] Create `Translations` struct with all UI text fields
  - [ ] Implement `Translations::load(language: Language) -> Translations`
  - [ ] Add fallback logic: if translation missing, use English
  - [ ] Add doc comments explaining system

- [ ] Implement English translations (AC: 3)
  - [ ] Define all translation keys as constants or struct fields
  - [ ] Translate all UI text:
    - `app_title`: "Pane"
    - `search_placeholder`: "Type to search..."
    - `footer_normal_hints`: "j/k Move | / Search | Enter Run | Esc Quit"
    - `footer_insert_hints`: "Type to search | Esc Normal mode"
    - `footer_insert_mode`: "-- INSERT --"
    - `footer_view_label`: "Tab View: {}"
    - `empty_skills_message`: "No skills available"
    - `detail_pane_title`: "Details"
    - `detail_description_label`: "Description:"
    - `detail_tags_label`: "Tags:"
    - `detail_estimated_time_label`: "Estimated Time:"
    - `output_panel_title`: "Output"
    - `output_panel_exit_code_label`: "Exit Code:"
    - `output_panel_execution_time_label`: "Execution Time:"
    - (Add more as needed)
  - [ ] Document all translation keys

- [ ] Implement Korean translations (AC: 3)
  - [ ] Translate all keys to Korean:
    - `app_title`: "페인"
    - `search_placeholder`: "검색어를 입력하세요..."
    - `footer_normal_hints`: "j/k 이동 | / 검색 | Enter 실행 | Esc 종료"
    - `footer_insert_hints`: "검색어 입력 | Esc 일반 모드"
    - `footer_insert_mode`: "-- 입력 --"
    - `footer_view_label`: "Tab 보기: {}"
    - `empty_skills_message`: "사용 가능한 스킬이 없습니다"
    - `detail_pane_title`: "상세 정보"
    - `detail_description_label`: "설명:"
    - `detail_tags_label`: "태그:"
    - `detail_estimated_time_label`: "예상 시간:"
    - `output_panel_title`: "출력"
    - `output_panel_exit_code_label`: "종료 코드:"
    - `output_panel_execution_time_label`: "실행 시간:"
    - (Add Korean translations for all keys)

- [ ] Integrate translations into AppState (AC: 3)
  - [ ] Add `translations: Translations` field to `AppState` in `src/state.rs`
  - [ ] Load translations in `AppState::new()` based on `config.language`
  - [ ] Add `translations(&self) -> &Translations` getter
  - [ ] Update initialization to handle translation loading errors

- [ ] Update UI components to use translations (AC: 3)
  - [ ] Update `src/ui/renderer.rs` header to use `state.translations().app_title`
  - [ ] Update `src/ui/components/search_bar.rs` to use `translations.search_placeholder`
  - [ ] Update `src/ui/components/footer.rs` to use translation keys for hints and mode
  - [ ] Update `src/ui/components/skill_list.rs` empty state to use `translations.empty_skills_message`
  - [ ] Update `src/ui/components/detail_pane.rs` labels to use translation keys
  - [ ] Update `src/ui/output_panel.rs` to use translation keys
  - [ ] Pass `translations` reference to all rendering functions that need it

- [ ] Update all UI rendering signatures (AC: 3)
  - [ ] Modify function signatures to accept `&Translations` parameter
  - [ ] Or use `&AppState` directly and extract translations inside components
  - [ ] Ensure consistent approach across all components

- [ ] Add validation and error handling (AC: 5, 6)
  - [ ] Validate language code in `Config::validate()`
  - [ ] Log warning if unsupported language, fallback to "en"
  - [ ] Handle missing translation files gracefully
  - [ ] Ensure app doesn't crash on translation errors

- [ ] Write comprehensive tests (AC: 7)
  - [ ] Test `Language::from_code()` with valid codes
  - [ ] Test `Language::from_code()` with invalid code falls back to En
  - [ ] Test `Translations::load()` for English
  - [ ] Test `Translations::load()` for Korean
  - [ ] Test fallback when translation file missing
  - [ ] Test Config with different language settings
  - [ ] Update existing UI component tests to pass translations
  - [ ] Ensure all tests pass

- [ ] Manual testing and validation (AC: 4)
  - [ ] Edit `~/.config/pane/config.toml` and set `language = "ko"`
  - [ ] Restart app, verify all UI is in Korean
  - [ ] Change to `language = "en"`, verify all UI is in English
  - [ ] Try invalid language like `language = "fr"`, verify fallback to English
  - [ ] Check all screens: main list, detail pane, output panel, footer
  - [ ] Verify Insert mode indicator shows "-- 입력 --" in Korean

## Dev Notes

### i18n System Design

**Goals**:
1. Simple, lightweight (no external i18n crates)
2. Easy to add new languages
3. Compile-time checked keys (no string typos at runtime)
4. Fallback chain: ko → en → hardcoded

**Architecture**:

```rust
// src/i18n.rs

#[derive(Debug, Clone, Copy, PartialEq, Eq)]
pub enum Language {
    En,
    Ko,
}

impl Language {
    pub fn from_code(code: &str) -> Self {
        match code.to_lowercase().as_str() {
            "ko" | "kor" | "korean" => Language::Ko,
            _ => Language::En, // Fallback to English
        }
    }

    pub fn code(&self) -> &'static str {
        match self {
            Language::En => "en",
            Language::Ko => "ko",
        }
    }
}

#[derive(Debug, Clone)]
pub struct Translations {
    // Header
    pub app_title: &'static str,

    // Search
    pub search_placeholder: &'static str,

    // Footer
    pub footer_normal_hints: &'static str,
    pub footer_insert_hints: &'static str,
    pub footer_insert_mode: &'static str,
    pub footer_view_all: &'static str,
    pub footer_view_favorites: &'static str,
    pub footer_view_recent: &'static str,

    // Skill list
    pub empty_skills_message: &'static str,

    // Detail pane
    pub detail_pane_title: &'static str,
    pub detail_description_label: &'static str,
    pub detail_tags_label: &'static str,
    pub detail_estimated_time_label: &'static str,
    pub detail_version_label: &'static str,
    pub detail_source_label: &'static str,

    // Output panel
    pub output_panel_title: &'static str,
    pub output_panel_stdout_label: &'static str,
    pub output_panel_stderr_label: &'static str,
    pub output_panel_exit_code_label: &'static str,
    pub output_panel_execution_time_label: &'static str,
    pub output_panel_close_hint: &'static str,
}

impl Translations {
    pub fn load(language: Language) -> Self {
        match language {
            Language::En => Self::english(),
            Language::Ko => Self::korean(),
        }
    }

    fn english() -> Self {
        Translations {
            app_title: "Pane",
            search_placeholder: "Type to search...",
            footer_normal_hints: "j/k Move | / Search | Enter Run | Esc Quit",
            footer_insert_hints: "Type to search | Esc Normal mode",
            footer_insert_mode: "-- INSERT --",
            footer_view_all: "All",
            footer_view_favorites: "Favorites",
            footer_view_recent: "Recent",
            empty_skills_message: "No skills available",
            detail_pane_title: "Details",
            detail_description_label: "Description:",
            detail_tags_label: "Tags:",
            detail_estimated_time_label: "Estimated Time:",
            detail_version_label: "Version:",
            detail_source_label: "Source:",
            output_panel_title: "Output",
            output_panel_stdout_label: "Standard Output:",
            output_panel_stderr_label: "Standard Error:",
            output_panel_exit_code_label: "Exit Code:",
            output_panel_execution_time_label: "Execution Time:",
            output_panel_close_hint: "Press Esc to close",
        }
    }

    fn korean() -> Self {
        Translations {
            app_title: "페인",
            search_placeholder: "검색어를 입력하세요...",
            footer_normal_hints: "j/k 이동 | / 검색 | Enter 실행 | Esc 종료",
            footer_insert_hints: "검색어 입력 | Esc 일반 모드",
            footer_insert_mode: "-- 입력 --",
            footer_view_all: "전체",
            footer_view_favorites: "즐겨찾기",
            footer_view_recent: "최근",
            empty_skills_message: "사용 가능한 스킬이 없습니다",
            detail_pane_title: "상세 정보",
            detail_description_label: "설명:",
            detail_tags_label: "태그:",
            detail_estimated_time_label: "예상 시간:",
            detail_version_label: "버전:",
            detail_source_label: "소스:",
            output_panel_title: "출력",
            output_panel_stdout_label: "표준 출력:",
            output_panel_stderr_label: "표준 에러:",
            output_panel_exit_code_label: "종료 코드:",
            output_panel_execution_time_label: "실행 시간:",
            output_panel_close_hint: "Esc를 눌러 닫기",
        }
    }
}
```

**Advantages**:
- No external dependencies
- Compile-time checked (typos caught at compile time)
- Easy to add new languages (just add new method)
- Simple fallback mechanism
- Fast (no runtime parsing)

**Disadvantages**:
- Translations hardcoded in binary (but acceptable for 2 languages)
- Need to recompile to add new language (but config can still switch between en/ko)

### Config Integration

**Add to `src/config.rs`**:

```rust
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
pub struct Config {
    // ... existing fields

    /// UI language (en, ko)
    #[serde(default = "default_language")]
    pub language: String,
}

fn default_language() -> String {
    "en".to_string()
}
```

**Example config.toml**:

```toml
# Language setting (en, ko)
language = "ko"

# Other settings...
default_view_mode = "All"
enable_mouse = true
max_recent_skills = 10
```

### UI Component Updates

**Before** (`src/ui/renderer.rs`):
```rust
let header = Block::default()
    .title("Pane")
    .borders(Borders::ALL)
```

**After**:
```rust
let header = Block::default()
    .title(state.translations().app_title)
    .borders(Borders::ALL)
```

**Before** (`src/ui/components/footer.rs`):
```rust
footer_spans.extend(vec![
    Span::raw("j/k Move"),
    Span::raw(" | "),
    Span::raw("/ Search"),
    // ...
]);
```

**After**:
```rust
// Parse hints string and create spans
let hints = match input_mode {
    InputMode::Normal => translations.footer_normal_hints,
    InputMode::Insert => translations.footer_insert_hints,
};
footer_spans.push(Span::raw(hints));
```

### ViewMode Translation

**Current**: ViewMode enum toString shows "All", "Favorites", "Recent"

**Update**:

```rust
// In footer.rs
let view_mode_text = match view_mode {
    ViewMode::All => translations.footer_view_all,
    ViewMode::Favorites => translations.footer_view_favorites,
    ViewMode::Recent => translations.footer_view_recent,
};
```

### Testing Strategy

**Unit Tests**:
1. Test `Language::from_code()` with "en", "EN", "english" → En
2. Test `Language::from_code()` with "ko", "KO", "korean", "kor" → Ko
3. Test `Language::from_code()` with "fr", "de", "" → En (fallback)
4. Test `Translations::load(Language::En)` returns English text
5. Test `Translations::load(Language::Ko)` returns Korean text

**Integration Tests**:
1. Test Config loading with `language = "ko"`
2. Test Config validation with invalid language
3. Test AppState initializes with correct translations

**Manual Tests**:
1. Set language to "ko", verify Korean UI
2. Set language to "en", verify English UI
3. Set invalid language, verify fallback to English
4. Check all UI components render correctly in both languages

### Migration Path

**Phase 1**: Infrastructure
- Add `src/i18n.rs` module
- Add `language` to Config
- Add tests for Language and Translations

**Phase 2**: Integration
- Add `translations` to AppState
- Update component signatures

**Phase 3**: UI Updates
- Update header
- Update footer
- Update search bar
- Update skill list
- Update detail pane
- Update output panel

**Phase 4**: Testing & Validation
- Run all tests
- Manual testing in both languages
- Documentation

### Extensibility

**Adding a new language (e.g., Japanese)**:

1. Add to Language enum:
```rust
pub enum Language {
    En,
    Ko,
    Ja, // NEW
}
```

2. Update `from_code()`:
```rust
"ja" | "jpn" | "japanese" => Language::Ja,
```

3. Add translation method:
```rust
fn japanese() -> Self {
    Translations {
        app_title: "ペイン",
        // ... all translations
    }
}
```

4. Update `load()`:
```rust
Language::Ja => Self::japanese(),
```

That's it! No other changes needed.

## Testing

### Unit Tests

**Language Code Parsing**:
1. `test_language_from_code_en`
2. `test_language_from_code_ko`
3. `test_language_from_code_case_insensitive`
4. `test_language_from_code_fallback`

**Translation Loading**:
5. `test_translations_load_english`
6. `test_translations_load_korean`
7. `test_translations_all_keys_present`

**Config Integration**:
8. `test_config_default_language_is_en`
9. `test_config_language_deserialization`
10. `test_config_validation_with_invalid_language`

### Integration Tests

1. Test full UI rendering in English
2. Test full UI rendering in Korean
3. Test language switch (English → Korean → English)

### Manual Testing Checklist

- [ ] Create/edit `~/.config/pane/config.toml` with `language = "ko"`
- [ ] Launch app, verify Korean UI everywhere
- [ ] Check header shows "페인"
- [ ] Check footer shows Korean hints
- [ ] Check Insert mode shows "-- 입력 --"
- [ ] Check search placeholder is in Korean
- [ ] Check skill detail labels are in Korean
- [ ] Execute a skill, check output panel is in Korean
- [ ] Change to `language = "en"`, restart
- [ ] Verify all UI is back to English
- [ ] Try `language = "invalid"`, verify English fallback
- [ ] Verify no crashes or errors

## Change Log

| Date       | Version | Description                 | Author             |
| ---------- | ------- | --------------------------- | ------------------ |
| 2025-11-20 | 1.0     | Initial i18n story creation | Dev Agent (James) |

## Dev Agent Record

### Agent Model Used

_To be filled during implementation_

### Debug Log References

_To be filled during implementation_

### Completion Notes

_To be filled during implementation_

### File List

_To be filled during implementation_

## QA Results

_To be filled by QA Agent after story completion_
